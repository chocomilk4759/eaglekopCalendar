/* =====================================================================================
  EAGLEKOP CALENDAR — GLOBAL STYLES (cleaned)
  - Theme tokens (light/dark)
  - Base reset & typography
  - Fixed header (Auth / Theme)
  - Calendar grid (auto/7 columns), cells & flags
  - Chips (pill base + cell override), emoji centering
  - Presets Dock (fixed right; collapsible; add form)
  - Auth popover
  - Date info modal (+ rest/flag buttons)
  - ModifyChipInfoModal helpers
  - Responsive rules (incl. data-tight policy)
===================================================================================== */

/* 1) THEME TOKENS -------------------------------------------------------------- */
:root{
  --bg:#ffffff;
  --fg:#111111;
  --muted:#666666;
  --border:#e5e5e5;
  --card:#ffffff;
  --accent:#222222;

  /* weekend colors */
  --sun:#d00;
  --sat:#05c;

  /* flags */
  --flagRed:#E74C4C;
  --flagBlue:#4C88DB;

  /* presets dock position */
  --dock-width-expanded: 320px;
  --dock-top: 84px;

  /* emoji nudge (platform fine-tune) */
  --emoji-nudge-y: -0.06em;
  --emoji-box: 1.25em;
}
[data-theme="dark"]{
  --bg:#0e0f12;
  --fg:#e9eaee;
  --muted:#a1a6b3;
  --border:#2a2d36;
  --card:#14161b;
  --accent:#f1f2f4;

  --sun:#ff6b6b;
  --sat:#6ab0ff;

  --flagRed:#E74C4C;
  --flagBlue:#4C88DB;
}

/* 2) BASE RESET & TYPOGRAPHY --------------------------------------------------- */
*,
*::before,
*::after{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0; background:var(--bg); color:var(--fg);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
}
a{ color:inherit; text-decoration:none; }
button, input, textarea, select{
  color:inherit; background:var(--card); border:1px solid var(--border);
  border-radius:10px; padding:8px 10px; font:inherit;
}
button{ cursor:pointer; transition:background .12s ease, box-shadow .12s ease, transform .06s ease; }
button:hover{ background:rgba(0,0,0,.03); }
button:active{ transform: translateY(.5px); }
.container{ width:100%; margin:0; padding:24px; max-width:none; }

/* 3) FIXED HEADER (Auth left / Theme right) ----------------------------------- */
.header-fixed{
  position:fixed; top:12px; left:0; right:0; width:100%;
  pointer-events:none; z-index:9999;
}
.header-fixed .left, .header-fixed .right{
  position:absolute; top:0; pointer-events:auto;
}
.header-fixed .left{ left:12px; }
.header-fixed .right{ right:12px; }

/* 4) CALENDAR (grid / cells / flags) ------------------------------------------ */
.grid{ display:grid; gap:14px; }
.calendar-grid.auto{
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); /* never exceeds 7 by layout */
}
.calendar-grid.seven{
  grid-template-columns: repeat(7, minmax(140px, 1fr));        /* exact 7 when space allows */
}
.day-name{ font-size:13px; opacity:.7; text-align:center; }
.day-name.sun{ color:var(--sun); }
.day-name.sat{ color:var(--sat); }

.calendar-grid .cell{
  position:relative; background:var(--card); border:1px solid var(--border);
  border-radius:12px; padding:10px; min-width:140px; min-height:200px; overflow:hidden;
}
.cell.today{ outline:2px solid var(--flagBlue); outline-offset:2px; }
.cell.sun .cell-date{ color:var(--sun); }
.cell.sat .cell-date{ color:var(--sat); }

/* flags (red/blue) */
.cell.flag-red{
  background:var(--flagRed);
  border-color: color-mix(in srgb, var(--flagRed) 85%, #000 15%);
}
.cell.flag-blue{
  background:var(--flagBlue);
  border-color: color-mix(in srgb, var(--flagBlue) 85%, #000 15%);
}
.cell.flag-red .cell-date, .cell.flag-blue .cell-date{ color:#fff !important; opacity:1; }

/* top bar: date | title | link */
.calendar-grid .cell-inner{ display:flex; flex-direction:column; height:100%; }
.calendar-grid .cell-top{
  --cell-top-h: 28px;
  display:grid; grid-template-columns:auto 1fr auto; align-items:center;
  column-gap:8px; min-height:var(--cell-top-h);
}
.calendar-grid .cell-date{ font-size:14px; opacity:.8; text-align:left; }
.calendar-grid .cell-title{ text-align:center; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.calendar-grid .cell-date.sun { color: var(--sun) !important; }
.calendar-grid .cell-date.sat { color: var(--sat) !important; }
.calendar-grid .cell-title.sun { color: var(--sun) !important; }
.calendar-grid .cell-title.sat { color: var(--sat) !important; }
.calendar-grid .cell-link{ text-align:right; }

/* link icon (top-right) */
.calendar-grid .cell .link-ico{
  position:absolute; top:8px; right:8px;
  display:inline-flex; align-items:center; justify-content:center;
  width:22px; height:22px; border:1px solid var(--border); border-radius:999px;
  background:var(--card); opacity:.95;
}
.calendar-grid .cell .link-ico:hover{ background:rgba(0,0,0,.03); }

/* content: default top-left; text-only center (visually centered accounting top bar) */
.calendar-grid .cell-content{
  flex:1; display:flex; align-items:flex-start; justify-content:flex-start;
  text-align:left; padding:6px; overflow:hidden;
}
.calendar-grid .cell-content.has-text{
  align-items:center !important; justify-content:center !important; text-align:center !important;
}
.calendar-grid .cell-content.has-text .cell-content-text,
.calendar-grid .cell-content.has-text .cell-rest{
  transform: translateY(calc(-1 * var(--cell-top-h) / 2)); /* exact center vs top bar */
}
.cell .cell-rest{
  display:flex; align-items:center; justify-content:center; width:100%; height:100%;
  color:#fff; font-weight:800; letter-spacing:.2px; font-size:clamp(20px, 2.8vw, 32px);
}
.cell.flag-red .cell-content-text,
.cell.flag-blue .cell-content-text{
  color:#fff; font-weight:800; font-size:clamp(18px, 2.6vw, 30px);
}
.calendar-grid .cell-content-text{ white-space:pre-wrap; word-break:break-word; overflow-wrap:anywhere; }

/* 5) CHIPS (pill base + cell override) ---------------------------------------- */
.chips{ display:flex; gap:4px; flex-wrap:wrap; margin-top:6px; }
.chip{
  max-width:100%;
  border:1px solid var(--border); border-radius:999px; padding:6px 10px;
  font-size:13px; display:inline-flex; align-items:center; justify-content:center; gap:6px;
  background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(242,242,242,.95));
  box-shadow: inset 0 1px 0 rgba(255,255,255,.8), 0 1px 2px rgba(0,0,0,.06);
}
[data-theme="dark"] .chip{
  background:linear-gradient(180deg, #1b1d23, #14161b);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06), 0 1px 2px rgba(0,0,0,.4);
}
.chip-text{ min-width:0; white-space:normal; overflow:hidden; text-overflow:ellipsis; }

/* cell chips: square-ish, tighter paddings, safe wrapping */
.calendar-grid .chips{ gap:4px; }
.calendar-grid .chip{
  padding:4px 8px; border-radius:8px; gap:4px; line-height:1.25; background:var(--card); box-shadow:0 1px 2px rgba(0,0,0,.06);
  margin:4px;
}
[data-theme="dark"] .calendar-grid .chip{ background:#171a20; box-shadow:0 1px 2px rgba(0,0,0,.4); }
.calendar-grid .chip-text{ white-space:normal; word-break:break-word; overflow-wrap:anywhere; }

/* emoji absolute centering (chips & icon button) */
.chip-emoji{
  display:inline-grid; place-items:center; width:var(--emoji-box); height:var(--emoji-box);
  line-height:1; transform: translateY(var(--emoji-nudge-y));
}
.icon-btn .emoji-glyph{
  display:inline-grid; place-items:center; width:1em; height:1em; line-height:1;
  transform: translateY(var(--emoji-nudge-y));
}
.chip-emoji > svg, .chip-emoji > img, .icon-btn .emoji-glyph > svg, .icon-btn .emoji-glyph > img{
  display:block; width:100%; height:100%;
}

/* 6) PRESETS DOCK (fixed overlay; collapsible) -------------------------------- */
.presets-dock{
  position:fixed; right:12px; top:var(--dock-top);
  z-index:9990; width:var(--dock-width-expanded); max-height:calc(100vh - 72px);
  display:flex; flex-direction:column; gap:8px; overflow:hidden;
  background:var(--card); border:1px solid var(--border); border-radius:12px; padding:8px;
  box-shadow:0 6px 16px rgba(0,0,0,.06); transition:width .18s ease;
}
.dock-toggle-wrap{ display:flex; justify-content:flex-end; align-items:center; height:28px; }
.dock-toggle{
  width:28px; height:28px; display:inline-flex; align-items:center; justify-content:center;
  border:1px solid var(--border); border-radius:8px; background:var(--card); font-weight:700;
}
.dock-toggle:hover{ background:rgba(0,0,0,.03); }
.preset-vertical-list{ overflow:auto; padding-right:2px; display:flex; flex-direction:column; align-items:flex-end; gap:0; }
.presets-dock.collapsed{ width:52px; }
.presets-dock.collapsed .preset-vertical-list{ display:none; }
.presets-dock.collapsed .dock-toggle-wrap{ justify-content:center; }

/* dock chips + add form (right aligned) */
.presets-dock .preset-chip{
  border-radius:10px; padding:8px 10px; margin:6px; background:var(--card); border:1px solid var(--border);
  box-shadow:0 1px 2px rgba(0,0,0,.06); white-space:nowrap; max-width:100%; overflow:hidden; text-overflow:ellipsis;
}
[data-theme="dark"] .presets-dock .preset-chip{ background:#171a20; border-color:#2a2d36; box-shadow:0 1px 2px rgba(0,0,0,.4); }
.preset-add-icon{
  display:inline-flex; align-items:center; justify-content:center; width:34px; height:34px; border-radius:999px;
  border:1px solid var(--border); background:var(--card); box-shadow:0 1px 2px rgba(0,0,0,.06); font-size:18px; line-height:1;
}
.preset-add-form{
  align-self:flex-end; width:auto; display:flex; flex-direction:column; gap:8px; align-items:flex-end;
  background:var(--card); border:1px solid var(--border); border-radius:12px; padding:10px; box-shadow:0 4px 12px rgba(0,0,0,.08);
}
.preset-add-form input[type="text"], .preset-add-form select{ width:240px; max-width:100%; }
.preset-add-actions{ display:flex; gap:8px; justify-content:flex-end; align-self:flex-end; }
.preset-chip .trash{
  margin-left:6px; border-radius:6px; border:1px solid #b12a2a; background:#ffefef; color:#b12a2a; padding:2px 8px; font-size:12px;
}
.preset-chip .trash:hover{ background:#ffd9d9; }
[data-theme="dark"] .preset-chip .trash{ background:#3a1212; border-color:#ff7a7a; color:#ff9a9a; }
[data-theme="dark"] .preset-chip .trash:hover{ background:#4a1a1a; }

/* 7) AUTH POPOVER -------------------------------------------------------------- */
.pop{
  position:absolute; top:44px; right:0; width:320px; max-width:calc(100vw - 24px);
  background:var(--card); border:1px solid var(--border); border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.1);
  padding:12px; opacity:0; transform:scale(.96); transform-origin: top right;
  pointer-events:none; transition: opacity .12s ease, transform .12s ease; z-index:9998;
}
.pop.open{ opacity:1; transform:scale(1); pointer-events:auto; }
.overlay{ position:fixed; inset:0; background:transparent; z-index:9997; }

/* 8) DATE INFO MODAL ----------------------------------------------------------- */
.modal{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:10000; }
.modal .sheet{
  width:min(720px,95vw); background:var(--card); border:1px solid var(--border); border-radius:16px;
  padding:16px; box-shadow:0 18px 48px rgba(0,0,0,.22);
}
.modal .date-head{ display:flex; align-items:center; gap:10px; }
.flag-buttons{ display:flex; gap:8px; margin-left:auto; }
.flag-btn{ width:28px; height:28px; border-radius:8px; border:1px solid var(--border); }
.flag-btn.red{ background:var(--flagRed); border-color:var(--flagRed); }
.flag-btn.blue{ background:var(--flagBlue); border-color:var(--flagBlue); }
.flag-btn.active{ box-shadow:0 0 0 2px #fff inset; }

/* rest button (white btn with X, active=red) */
.rest-btn{
  width:28px; height:28px; border:1px solid var(--border); border-radius:8px; background:#fff; color:#222;
  display:inline-flex; align-items:center; justify-content:center;
}
.rest-btn:hover{ background:rgba(0,0,0,.03); }
.rest-btn.active{ background:var(--flagRed); border-color:var(--flagRed); color:#fff; }

.modal textarea{ resize:none; }
.actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:8px; }

/* 9) MODIFY-CHIP MODAL HELPERS ------------------------------------------------- */
.icon-chooser{ position:relative; width:36px; height:36px; flex:0 0 36px; }
.icon-chooser .icon-btn{ position:absolute; inset:0; }
.icon-chooser .icon-combo{
  position:absolute; left:0; top:40px; z-index:10020;
  padding:6px 10px; border:1px solid var(--border); border-radius:8px; background:var(--card);
  cursor: default !important; /* hover cursor stays default */
}

/* 10) RESPONSIVE --------------------------------------------------------------- */
@media (max-width:980px){
  .container{ padding:16px; }
  .presets-dock{ position:static; width:auto; max-height:none; right:auto; top:auto; margin-top:8px; }
}
@media (max-width:640px){
  .pop{ width:92vw; }
}

/* mobile: always show horizontal scrollbar for chips (if any scroll area used) */
@media (max-width:767px){
  .chips-scroll{ overflow-x:scroll !important; scrollbar-gutter:stable both-edges; }
  .chips-scroll::-webkit-scrollbar{ height:6px; }
  .chips-scroll::-webkit-scrollbar-thumb{ background:rgba(0,0,0,.3); border-radius:3px; }
  .chips-scroll::-webkit-scrollbar-track{ background:rgba(0,0,0,.05); }
  .chips-scroll{ scrollbar-width:thin; }
}

/* 11) DATA POLICY (compact vs tight) ------------------------------------------ */
/* Calendar.tsx sets:
   - html[data-compact="0|1"] : whether 7 columns fit (for weekday titles etc.)
   - html[data-tight="1"]     : when columns <= 4 → hide Auth & PresetsDock  */
html[data-tight="1"] .header-fixed,
html[data-tight="1"] .presets-dock{ display:none !important; }
/* no automatic hiding on data-compact anymore */

/* 아이콘이 보이는 레이아웃: data-compact="0" (row 레이아웃) */
html[data-compact="0"] .calendar-grid { padding-left: 60px; padding-right: 60px; }
/* column 레이아웃이면 패딩 제거 */
html[data-compact="1"] .calendar-grid { padding-left: 0; padding-right: 0; }

/* column 레이아웃이면 Auth / PresetsDock 숨김 */
html[data-compact="1"] .header-fixed,
html[data-compact="1"] .presets-dock { display: none !important; }
